<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>5 modos de carregar arquivos no Google Colab &#8211; Mayra Azevedo</title> <meta name="description" content="O Google Colab é uma ferramenta criada pelo Google que permite que qualquer pessoa consiga produzir e rodar desde os notebooks IPython (.ipynb) mais simples até treinar um modelo de deep learning mesmo sem possuir uma GPU. É só usar sua conta Google e você terá acesso a 12GB de RAM, GPU/TPU (desde que não abuse e use para ganhar criptomoedas), sendo todo seu trabalho sincronizado no Drive."> <meta name="keywords" content="colab, data science, python"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://avatars0.githubusercontent.com/u/23341788?s=460&v=4"> <meta name="twitter:title" content="5 modos de carregar arquivos no Google Colab"> <meta name="twitter:description" content="O Google Colab é uma ferramenta criada pelo Google que permite que qualquer pessoa consiga produzir e rodar desde os notebooks IPython (.ipynb) mais simples até treinar um modelo de deep learning mesmo sem possuir uma GPU. É só usar sua conta Google e você terá acesso a 12GB de RAM, GPU/TPU (desde que não abuse e use para ganhar criptomoedas), sendo todo seu trabalho sincronizado no Drive."> <meta name="twitter:site" content="@nymaryah"> <meta name="twitter:creator" content="@nymaryah"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="5 modos de carregar arquivos no Google Colab"> <meta property="og:description" content="O Google Colab é uma ferramenta criada pelo Google que permite que qualquer pessoa consiga produzir e rodar desde os notebooks IPython (.ipynb) mais simples até treinar um modelo de deep learning mesmo sem possuir uma GPU. É só usar sua conta Google e você terá acesso a 12GB de RAM, GPU/TPU (desde que não abuse e use para ganhar criptomoedas), sendo todo seu trabalho sincronizado no Drive."> <meta property="og:url" content="http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/"> <meta property="og:site_name" content="Mayra Azevedo"> <meta property="og:image" content="http://localhost:4000/images/https://avatars0.githubusercontent.com/u/23341788?s=460&v=4"> <link rel="canonical" href="http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Mayra Azevedo" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/workset.jpeg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/workset.jpeg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/natown.jpg) no-repeat;background-size: cover;} </style> <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'></script> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">5 modos de carregar arquivos no Google Colab </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#colab">colab</a></li> <li><a href="http://localhost:4000/tags#data science">data science</a></li> <li><a href="http://localhost:4000/tags#python">python</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="http://localhost:4000" title="home" class="home-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">31/03/2019</div> <p>O <a href="https://colab.research.google.com">Google Colab</a> é uma ferramenta criada pelo Google que permite que qualquer pessoa consiga produzir e rodar desde os notebooks IPython (<code class="highlighter-rouge">.ipynb</code>) mais simples até treinar um modelo de <em>deep learning</em> mesmo sem possuir uma GPU. É só usar sua conta Google e você terá acesso a 12GB de RAM, GPU/TPU (desde que não abuse e use para ganhar criptomoedas), sendo todo seu trabalho sincronizado no Drive.</p> <p>Um dos primeiros problemas que aparecem ao usar o Colab é: como carregar arquivos nessa ferramenta, já que ele não tem acesso ao meu HD? Nesse post são listados 5 jeitos de fazer isso, cada um com suas vantagens e desvantagens.</p> <h3 id="1-usando-um-link">1. Usando um link</h3> <p>Basta ver a documentação do método <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html"><code class="highlighter-rouge">read_csv</code></a> da biblioteca <code class="highlighter-rouge">pandas</code> para ver que uma url pode ser usada para carregar seu dataset. O jeito mais fácil de disponibilizar um link é fazendo o upload dos dados para o GitHub, mas nesse caso existe a limitação de que o arquivo deve ter menos de 25MB (um arquivo maior não pode ser mantido em seu repositório).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="o">*</span><span class="n">link</span><span class="o">*</span><span class="p">)</span>
</code></pre></div></div> <p>Algumas alternativas ao GitHub como <a href="https://gitlab.com">GitLab</a> e <a href="http://bitbucket.org">BitBucket</a> possuem um limite mais flexível, o primeiro depende das configurações da sua organização e no segundo caso, o arquivo deve respeitar o limite de tamanho do repositório, que não pode ser maior que 2GB.</p> <h3 id="2-fazendo-upload-de-sua-máquina-via-código">2. Fazendo upload de sua máquina via código</h3> <blockquote> <p>Método apresentado no post do Towards Data Science: <a href="https://towardsdatascience.com/3-ways-to-load-csv-files-into-colab-7c14fcbdcb92">3 Ways to load csv into colab</a></p> </blockquote> <p>O Colab possibilita que você insira arquivos do seu computador no notebook através do método <code class="highlighter-rouge">files</code> do módulo <code class="highlighter-rouge">google.colab</code>. Ao chamar <code class="highlighter-rouge">files.upload()</code>, uma caixa de seleção vai aparecer como na imagem abaixo:</p> <p><img src="../images/posts/colab_upload_file_code.png" alt="colab_upload_file_code" /></p> <p>Depois de escolher o arquivo, o objeto <code class="highlighter-rouge">uploaded</code> acima, que é um dicionário com os dados em formato de bytes, pode ser manipulado para virar um objeto tratado pelo <code class="highlighter-rouge">pandas</code>. Para isso, usamos a biblioteca <code class="highlighter-rouge">io</code>, como mostrado no exemplo abaixo.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">uploaded</span><span class="p">[</span><span class="s">'file.csv'</span><span class="p">]))</span>
</code></pre></div></div> <p>Apesar de ser prático para um estudo rápido sobre um arquivo pequeno, por exemplo, essa <em>feature</em> pode apresentar incompatibilidade com algumas versões de alguns navegadores, então nem sempre o método é aplicável.</p> <h3 id="3-fazendo-upload-de-sua-máquina-via-colab">3. Fazendo upload de sua máquina via colab</h3> <p>Uma alternativa relativamente recente, oferecida pelo próprio Colab, é usar a seção <code class="highlighter-rouge">Files</code> do menu lateral.</p> <p><img src="../images/posts/cola_files_tab.png" alt="cola_files_tab" /></p> <p>Ao cliclar no botão <strong>UPLOAD</strong>, uma janela de seleção semelhante à do item anterior será aberta. Depois do upload, o arquivo é listado nessa seção. Com 2 cliques é possível ainda visualizar (e filtrar!) o conteúdo do dataset.</p> <p><img src="../images/posts/colab_file_preview.png" alt="colab_file_preview" /></p> <p>No entanto, a maior mudança em relação ao <code class="highlighter-rouge">google.colab</code> é que, além de apresentar maior compatibilidade com os navegadores, o arquivo não precisa ser convertido. Dá pra usar <code class="highlighter-rouge">read_csv</code> passando o nome do arquivo e a extensão.</p> <hr /> <p>Os dois últimos métodos possuem algumas desvantagens em comum:</p> <ul> <li> <p>Toda vez que o notebook for aberto, o processo de upload precisa ser repetido ( o que prejudica muito a reproducibilidade do que você fez no notebook);</p> </li> <li> <p>Um arquivo grande vai demorar bastante, principalmente se a sua internet não for tão rápida.</p> </li> </ul> <p>Por isso, os dois se tornam mais úteis quando se quer fazer algo rápido e que não precisa ser compartilhado com outras pessoas.</p> <h3 id="4-google-drive">4. Google Drive</h3> <p>Ao abrir uma pasta no Google Drive, você pode observar que ela possui um <em>hash</em>, um código em sua url. Bem, dá para usar esse link para ler os arquivos dessa pasta.</p> <p>O primeiro passo é a <del>aceitação</del> autenticação. Ao rodar o código abaixo e clicar no link, você vai recer um <em>token</em> para copiar e colar na caixa que é exibida no notebook.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="n">auth</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="n">drive_service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s">'drive'</span><span class="p">,</span> <span class="s">'v3'</span><span class="p">)</span>
</code></pre></div></div> <p><img src="../images/posts/colab_drive_auth.png" alt="colab_drive_auth" /></p> <p>Depois de se autenticar, você já pode usar o objeto <code class="highlighter-rouge">drive_service</code> para consultar os arquivos. Com a API do Google Drive, é possível fazer a consulta especificando um parâmetro do método <code class="highlighter-rouge">files().list()</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">" '"</span><span class="o">+</span><span class="n">folder</span> <span class="o">+</span><span class="s">"' in parents"</span><span class="p">,</span>
 <span class="n">spaces</span><span class="o">=</span><span class="s">'drive'</span><span class="p">,</span>
 <span class="n">fields</span><span class="o">=</span><span class="s">'nextPageToken, files(id, name)'</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div></div> <p>Especificando <code class="highlighter-rouge">'"+folder+"' in parents</code> são filtrados os arquivos que estão dentro da pasta <code class="highlighter-rouge">folder</code>.</p> <p>Depois de recuperados os arquivos, iterar sobre eles, vamos recuperar seus IDs e usar <code class="highlighter-rouge">files().get_media(fileId=id)</code> para baixar o arquivo através da API. Depois disso, os bytes podem ser traduzidos e o arquivo tratado.</p> <p>Tudo isso deve ser feito dentro de um loop.</p> <p>Abaixo, um código completo com o exemplo de arquivos de imagens</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">page_token</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">"mimeType='image/png' and '"</span><span class="o">+</span><span class="n">folder</span> <span class="o">+</span><span class="s">"' in parents"</span><span class="p">,</span>
                                            <span class="n">spaces</span><span class="o">=</span><span class="s">'drive'</span><span class="p">,</span>
                                            <span class="n">fields</span><span class="o">=</span><span class="s">'nextPageToken, files(id, name)'</span><span class="p">,</span>
                                            <span class="n">pageToken</span><span class="o">=</span><span class="n">page_token</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
      <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'files'</span><span class="p">,</span> <span class="p">[]):</span>
          <span class="c1"># Process change
</span>          <span class="n">file_id</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
          <span class="n">request</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">get_media</span><span class="p">(</span><span class="n">fileId</span><span class="o">=</span><span class="n">file_id</span><span class="p">)</span>
          <span class="n">downloaded</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
          <span class="n">downloader</span> <span class="o">=</span> <span class="n">MediaIoBaseDownload</span><span class="p">(</span><span class="n">downloaded</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
          <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
          <span class="k">while</span> <span class="n">done</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c1"># _ is a placeholder for a progress object that we ignore.
</span>            <span class="c1"># (Our file is small, so we skip reporting progress.)
</span>            <span class="n">_</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">next_chunk</span><span class="p">()</span>

          <span class="n">downloaded</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

           <span class="k">if</span><span class="p">(</span><span class="s">'.csv'</span> <span class="ow">in</span> <span class="nb">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">)):</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">downloaded</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

      <span class="n">page_token1</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'nextPageToken'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">page_token1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">break</span>
</code></pre></div></div> <p>Com os arquivos recuperados, para usar o dataset, podemos passar o objeto para <code class="highlighter-rouge">read_csv</code>, por exemplo:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div> <p>Com essa alternativa mais complexa, é preciso ter cuidado ao filtrar os arquivos, além de compartilhar toda a pasta com quem precisar reproduzir o estudo feito usando essa técnica.</p> <h3 id="5-arquivos-compactados">5. Arquivos compactados</h3> <p>O último método é na verdade um caso específico que pode acontecer ao usar qualquer um das opções anteriores.</p> <p>Alguns tipos de arquivos compactados não são lidos facilmente pelo <code class="highlighter-rouge">pandas</code>, como os disponilizados pelo IMDb. Para tratá-los, podemos usar a biblioteca <code class="highlighter-rouge">gzip</code> para descompactar e o método <code class="highlighter-rouge">urllib</code> do módulo <code class="highlighter-rouge">six.moves</code> para baixar o dataset. E <em>voilà</em>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">urllib</span>
<span class="kn">import</span> <span class="nn">gzip</span>

<span class="n">handle</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">'https://datasets.imdbws.com/title.basics.tsv.gz'</span><span class="p">)</span> <span class="c1">#download
</span><span class="nb">file</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">handle</span><span class="p">)</span> <span class="c1">#unzip
</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div> <h2 id="considerações-finais">Considerações finais</h2> <p>Cada método tem seu nível de dificuldade e uma limitação quanto ao tamanho da massa de dados que podem ser carregados de forma eficiente, cabe a cada um ver qual se encaixa melhor em cada situação.</p> <p>Nos links, existe a referência para uma alternativa ao passo 4 e alguns métodos para salvar arquivos a partir do Colab.</p> <p>Até a próxima!</p> <h2 id="links">Links</h2> <p><a href="https://developers.google.com/drive/api/v3/search-parameters">API de busca de arquivos do Google Drive</a></p> <p><a href="https://colab.research.google.com/notebooks/io.ipynb">Material do próprio Colab que contém maneiras de salvar arquivos</a></p> <br> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/5-modos-de-carregar-arquivos-no-google-colab/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="http://localhost:4000/o-absurdo-do-teste-de-hipotese/" class="pagination_pager" title="O absurdo no teste de hipótese ">previous</a> <a href="#" class="pagination_pager disabled">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://github.com/nymarya/nymarya.github.io/blob/master/images/retsus.png?raw=true) center center no-repeat;"> <a href="https://retsus.ufrn.br" target="_blank" rel="nofollow external"> <span> RETSUS </span> </a> </li> <li style="background:url(https://github.com/nymarya/nymarya.github.io/blob/master/images/sgp.png?raw=true) center center no-repeat;"> <a href="http://sgp.lais.huol.ufrn.br" target="_blank" rel="nofollow external"> <span> SGP </span> </a> </li> <li style="background:url(http://localhost:4000/) center center no-repeat;"> <a href="" target="_blank" rel="nofollow external"> <span> Olho Biônico </span> </a> </li> <li style="background:url(http://localhost:4000/) center center no-repeat;"> <a href="" target="_blank" rel="nofollow external"> <span> PRODOC </span> </a> </li> <li style="background:url(http://adcon.rn.gov.br/ACERVO/seec/IMG/IMG000000000176382.JPEG) center center no-repeat;"> <a href="http://www.educacao.rn.gov.br/Conteudo.asp?TRAN=ITEM&TARG=176381&ACT=&PAGE=&PARM=&LBL=MAT%C9RIA" target="_blank" rel="nofollow external"> <span> Comunica-EDU </span> </a> </li> </ul> </div> </body> </html>
